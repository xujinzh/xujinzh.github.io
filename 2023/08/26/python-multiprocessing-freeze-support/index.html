<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Python 多进程 multiprocessing 在 Linux、Mac 和 Windows 上的区别 | J. Xu</title><meta name="author" content="Jinzhong Xu"><meta name="copyright" content="Jinzhong Xu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python 中多进程模型 multiprocessing 在不同操作系统 api 不同，导致运行差异。本篇对其进行介绍。">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 多进程 multiprocessing 在 Linux、Mac 和 Windows 上的区别">
<meta property="og:url" content="https://xujinzh.github.io/2023/08/26/python-multiprocessing-freeze-support/index.html">
<meta property="og:site_name" content="J. Xu">
<meta property="og:description" content="Python 中多进程模型 multiprocessing 在不同操作系统 api 不同，导致运行差异。本篇对其进行介绍。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xujinzh.github.io/img/c7.jpg">
<meta property="article:published_time" content="2023-08-26T03:40:27.000Z">
<meta property="article:modified_time" content="2024-01-30T15:35:56.104Z">
<meta property="article:author" content="Jinzhong Xu">
<meta property="article:tag" content="python">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="mac">
<meta property="article:tag" content="windows">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xujinzh.github.io/img/c7.jpg"><link rel="shortcut icon" href="/img/letter-j.png"><link rel="canonical" href="https://xujinzh.github.io/2023/08/26/python-multiprocessing-freeze-support/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python 多进程 multiprocessing 在 Linux、Mac 和 Windows 上的区别',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-30 23:35:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/silence.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">384</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">296</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">25</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="J. Xu"><img class="site-icon" src="/img/letter-j.png"/><span class="site-name">J. Xu</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Python 多进程 multiprocessing 在 Linux、Mac 和 Windows 上的区别</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-26T03:40:27.000Z" title="发表于 2023-08-26 11:40:27">2023-08-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-30T15:35:56.104Z" title="更新于 2024-01-30 23:35:56">2024-01-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/technology/">technology</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/technology/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Python 多进程 multiprocessing 在 Linux、Mac 和 Windows 上的区别"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p>Python 中多进程模型 multiprocessing 在不同操作系统 api 不同，导致运行差异。本篇对其进行介绍。</p>
<span id="more"></span>


<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p><strong>导致差异的根本原因是多进程启动的方式</strong></p>
<p>在 Linux 操作系统中，默认创建子进程的方式是 <code>fork</code>，而在 Mac&#x2F;Windows 系统中，默认创建子进程的方式是 <code>spawn</code>。查看启动方式可以使用如下 Python 代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(multiprocessing.get_start_method())</span><br></pre></td></tr></table></figure>

<p>在 Windows 上只能使用 spawn，但是，在 Linux 和 Mac（给予 Unix）上却可以设置采用哪种启动方式，方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&quot;fork&quot;</span>)  <span class="comment"># &quot;fork&quot; or &quot;spawn&quot; 都可以在 Linux or Mac 上; Windows only have spawn</span></span><br><span class="line">    <span class="built_in">print</span>(multiprocessing.get_start_method())</span><br></pre></td></tr></table></figure>

<p><strong>fork 和 spawn 的区别就是 spawn 启动多进程会默认将当前脚本或模块在主进程和子进程都执行一遍</strong>，如下面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_hi</span>(<span class="params">text: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;hello, <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">i = i + <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;i=<span class="subst">&#123;i&#125;</span>，当前进程id：<span class="subst">&#123;os.getpid()&#125;</span>，当前进程处理模块名：<span class="subst">&#123;__name__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&quot;spawn&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;多进程启动方式：<span class="subst">&#123;multiprocessing.get_start_method()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;父进程id：<span class="subst">&#123;os.getpid()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 创建2个子进程</span></span><br><span class="line">    p = multiprocessing.Pool(processes=<span class="number">2</span>)</span><br><span class="line">    texts = [<span class="string">&quot;xiaoming&quot;</span>, <span class="string">&quot;luban&quot;</span>]</span><br><span class="line">    p.<span class="built_in">map</span>(print_hi, texts)</span><br></pre></td></tr></table></figure>
<p>输出结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94695</span>，当前进程处理模块名：__main__</span><br><span class="line">多进程启动方式：spawn</span><br><span class="line">父进程<span class="built_in">id</span>：<span class="number">94695</span></span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94698</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94699</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">hello, xiaoming</span><br><span class="line">hello, luban</span><br></pre></td></tr></table></figure>

<p>如果改成 fork 方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_hi</span>(<span class="params">text: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;hello, <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">i = i + <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;i=<span class="subst">&#123;i&#125;</span>，当前进程id：<span class="subst">&#123;os.getpid()&#125;</span>，当前进程处理模块名：<span class="subst">&#123;__name__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&quot;fork&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;多进程启动方式：<span class="subst">&#123;multiprocessing.get_start_method()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;父进程id：<span class="subst">&#123;os.getpid()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 创建2个子进程</span></span><br><span class="line">    p = multiprocessing.Pool(processes=<span class="number">2</span>)</span><br><span class="line">    texts = [<span class="string">&quot;xiaoming&quot;</span>, <span class="string">&quot;luban&quot;</span>]</span><br><span class="line">    p.<span class="built_in">map</span>(print_hi, texts)</span><br></pre></td></tr></table></figure>
<p>那么输出结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94714</span>，当前进程处理模块名：__main__</span><br><span class="line">多进程启动方式：fork</span><br><span class="line">父进程<span class="built_in">id</span>：<span class="number">94714</span></span><br><span class="line">hello, xiaoming</span><br><span class="line">hello, luban</span><br></pre></td></tr></table></figure>
<p>可见，spawn 方式的会把当前脚本在子进程中原模原样执行，只是在子进程中遇到条件判断 <code>if __name__ == &quot;__main__&quot;</code> 时，因不符合条件而未执行里面的内容。</p>
<h1 id="启动方法的区别"><a href="#启动方法的区别" class="headerlink" title="启动方法的区别"></a>启动方法的区别</h1><p>fork 和 spawn 的区别是什么呢？</p>
<ul>
<li>fork：除了必要的启动资源外，其他变量、包、数据等都继承自父进程，并且是 copy-on-write 的。也就是说，共享了父进程的一些内存页，因此启动较快。但是由于大部分都用的父进程数据，所以是不安全的进程；</li>
<li>spawn：从头构建一个子进程，父进程的数据等拷贝到子进程空间内，拥有自己的Python解释器，所以需要重新加载一遍父进程的包，也因此导致启动较慢。但是由于数据都是自己的，安全性较高。</li>
</ul>
<p>Windows 系统只支持 spawn，而 Linux&#x2F;Mac 既支持 spawn 又支持 fork，可根据需要选择。</p>
<p>其实，在 Linux&#x2F;Mac 上启动方法有三类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: multiprocessing.get_all_start_methods()</span><br><span class="line">Out[<span class="number">2</span>]: [<span class="string">&#x27;fork&#x27;</span>, <span class="string">&#x27;spawn&#x27;</span>, <span class="string">&#x27;forkserver&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>各系统支持的方法：</strong></p>
<ul>
<li>Windows (win32): spawn</li>
<li>macOS (darwin): spawn, fork, forkserver</li>
<li>Linux (unix): spawn, fork, forkserver</li>
</ul>
<p><strong>各系统默认方法：</strong></p>
<ul>
<li>Windows (win32): spawn</li>
<li>macOS (darwin): spawn</li>
<li>Linux (unix): fork</li>
</ul>
<p><strong>三种区别：</strong></p>
<ul>
<li>spawn: start a new Python process.</li>
<li>fork: copy a Python process from an existing process.</li>
<li>forkserver: new process from which future forked processes will be copied.</li>
</ul>
<p>Forking and spawning are two different start methods for new processes. Fork is the default on Linux (it isn’t available on Windows), while Windows and MacOS use spawn by default.</p>
<p>When a process is forked the child process inherits all the same variables in the same state as they were in the parent. Each child process then continues independently from the forking point. The pool divides the args between the children and they work though them sequentially.</p>
<p>On the other hand, when a process is spawned, it begins by starting a new Python interpreter. The current module is reimported and new versions of all the variables are created. The plot_function is then called on each of the the args allocated to that child process. As with forking, the child processes are independent of each other and the parent.</p>
<p>Neither method copies running threads into the child processes.</p>
<table>
<thead>
<tr>
<th>特点</th>
<th>fork</th>
<th>spawn</th>
</tr>
</thead>
<tbody><tr>
<td>Import module at start of each child process</td>
<td>no</td>
<td>yes</td>
</tr>
<tr>
<td>Variables have same id as in parent process</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td>Child process gets variables defined in name &#x3D;&#x3D; main block</td>
<td>yes</td>
<td>no</td>
</tr>
</tbody></table>
<h1 id="设置启动方法"><a href="#设置启动方法" class="headerlink" title="设置启动方法"></a>设置启动方法</h1><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"><span class="comment"># protect the entry point</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="comment"># set the start method</span></span><br><span class="line">	multiprocessing.set_start_method(<span class="string">&#x27;spawn&#x27;</span>)</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure>

<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"><span class="comment"># protect the entry point</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="comment"># get a context configured with a start method</span></span><br><span class="line">  context = multiprocessing.get_context(<span class="string">&#x27;fork&#x27;</span>)</span><br><span class="line">  <span class="comment"># create a child process via a context</span></span><br><span class="line">  process = context.Process(...)</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment"># set the start method</span></span><br><span class="line">  context.set_start_method(<span class="string">&#x27;spawn&#x27;</span>, force=<span class="literal">True</span>)</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure>


<h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><p>如果在 Windows 上或者采用 spawn 启动方式的 Linux&#x2F;Mac 上，没有使用 <code>if __name__ == &quot;__main__&quot;:</code>，那么会报异常，测试代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import multiprocessing</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def print_hi(text: str):</span><br><span class="line">    <span class="built_in">print</span>(f<span class="string">&quot;hello, &#123;text&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = 0</span><br><span class="line">i = i + 1</span><br><span class="line"><span class="built_in">print</span>(f<span class="string">&quot;i=&#123;i&#125;，当前进程id：&#123;os.getpid()&#125;，当前进程处理模块名：&#123;__name__&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># multiprocessing.freeze_support()</span></span><br><span class="line">multiprocessing.set_start_method(<span class="string">&quot;spawn&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(f<span class="string">&quot;多进程启动方式：&#123;multiprocessing.get_start_method()&#125;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(f<span class="string">&quot;父进程id：&#123;os.getpid()&#125;&quot;</span>)</span><br><span class="line"><span class="comment"># 创建2个子进程</span></span><br><span class="line">p = multiprocessing.Pool(processes=2)</span><br><span class="line">texts = [<span class="string">&quot;xiaoming&quot;</span>, <span class="string">&quot;luban&quot;</span>]</span><br><span class="line">p.map(print_hi, texts)</span><br></pre></td></tr></table></figure>
<p>报异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94918</span>，当前进程处理模块名：__main__</span><br><span class="line">多进程启动方式：spawn</span><br><span class="line">父进程<span class="built_in">id</span>：<span class="number">94918</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">120</span>, <span class="keyword">in</span> spawn_main</span><br><span class="line">    exitcode = _main(fd, parent_sentinel)</span><br><span class="line">               ^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">129</span>, <span class="keyword">in</span> _main</span><br><span class="line">    prepare(preparation_data)</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">240</span>, <span class="keyword">in</span> prepare</span><br><span class="line">    _fixup_main_from_path(data[<span class="string">&#x27;init_main_from_path&#x27;</span>])</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">291</span>, <span class="keyword">in</span> _fixup_main_from_path</span><br><span class="line">    main_content = runpy.run_path(main_path,</span><br><span class="line">                   ^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">291</span>, <span class="keyword">in</span> run_path</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">98</span>, <span class="keyword">in</span> _run_module_code</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">88</span>, <span class="keyword">in</span> _run_code</span><br><span class="line">  File <span class="string">&quot;/Users/jinzhongxu/Codes/torch-test/windows-spawn.py&quot;</span>, line <span class="number">14</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&quot;spawn&quot;</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/context.py&quot;</span>, line <span class="number">247</span>, <span class="keyword">in</span> set_start_method</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;context has already been set&#x27;</span>)</span><br><span class="line">RuntimeError: context has already been <span class="built_in">set</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">120</span>, <span class="keyword">in</span> spawn_main</span><br><span class="line">    exitcode = _main(fd, parent_sentinel)</span><br><span class="line">               ^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">129</span>, <span class="keyword">in</span> _main</span><br><span class="line">    prepare(preparation_data)</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">240</span>, <span class="keyword">in</span> prepare</span><br><span class="line">    _fixup_main_from_path(data[<span class="string">&#x27;init_main_from_path&#x27;</span>])</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">291</span>, <span class="keyword">in</span> _fixup_main_from_path</span><br><span class="line">    main_content = runpy.run_path(main_path,</span><br><span class="line">                   ^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">291</span>, <span class="keyword">in</span> run_path</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">98</span>, <span class="keyword">in</span> _run_module_code</span><br><span class="line">  File <span class="string">&quot;&lt;frozen runpy&gt;&quot;</span>, line <span class="number">88</span>, <span class="keyword">in</span> _run_code</span><br><span class="line">  File <span class="string">&quot;/Users/jinzhongxu/Codes/torch-test/windows-spawn.py&quot;</span>, line <span class="number">14</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&quot;spawn&quot;</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/context.py&quot;</span>, line <span class="number">247</span>, <span class="keyword">in</span> set_start_method</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;context has already been set&#x27;</span>)</span><br><span class="line">RuntimeError: context has already been <span class="built_in">set</span></span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94921</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94922</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94923</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">i=<span class="number">1</span>，当前进程<span class="built_in">id</span>：<span class="number">94924</span>，当前进程处理模块名：__mp_main__</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/miniconda/lib/python3.11/multiprocessing/spawn.py&quot;</span>, line <span class="number">120</span>, <span class="keyword">in</span> spawn_main</span><br><span class="line">    exitcode = _main(fd, parent_sentinel)</span><br><span class="line">               ^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></pre></td></tr></table></figure>
<p>或者在 Pytorch 多进程采样训练时，出现：<code>freeze_support()</code> 等报错。</p>
<p>这就是因为 spawn 方式会把当前脚本拷贝到多个子进程中，子进程有遇到启动多进程代码，会无限循环创建子进程执行。因此，最安全的方式是添加上: <code>if __name__ == &quot;__main__&quot;</code>。</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/88836284ad2e">python3 多进程代码，抛出 RuntimeError：省略.. The “freeze_support()” line can be omitted if the program …</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_28327765/article/details/120495877">multiprocessing 中fork和spawn的区别</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/2/library/multiprocessing.html#windows">multiprocessing — Process-based “threading” interface</a>、</li>
<li><a target="_blank" rel="noopener" href="https://superfastpython.com/multiprocessing-start-method/#:~:text=A%20start%20method%20is%20the,process%20from%20an%20existing%20process.">Multiprocessing Start Methods</a></li>
<li><a target="_blank" rel="noopener" href="https://britishgeologicalsurvey.github.io/science/python-forking-vs-spawn/">Fork vs Spawn in Python Multiprocessing</a></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://xujinzh.github.io">Jinzhong Xu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://xujinzh.github.io/2023/08/26/python-multiprocessing-freeze-support/">https://xujinzh.github.io/2023/08/26/python-multiprocessing-freeze-support/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xujinzh.github.io" target="_blank">J. Xu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/mac/">mac</a><a class="post-meta__tags" href="/tags/windows/">windows</a></div><div class="post_share"><div class="social-share" data-image="/img/c7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/28/python-venv-introduction/" title="python 虚拟环境 venv 介绍"><img class="cover" src="/img/c25.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python 虚拟环境 venv 介绍</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/25/mac-terminal-linux-chinese-characters/" title="Mac ssh 连接 Linux 终端中文显示乱码解决方法"><img class="cover" src="/img/c22.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mac ssh 连接 Linux 终端中文显示乱码解决方法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/06/auto-email-server-ip/" title="服务器开机或IP改变自动发送通知邮件"><img class="cover" src="/img/c6.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-06</div><div class="title">服务器开机或IP改变自动发送通知邮件</div></div></a></div><div><a href="/2021/11/29/auto-email-server-shutdown/" title="服务器关机自动发送通知邮件"><img class="cover" src="/img/c6.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-29</div><div class="title">服务器关机自动发送通知邮件</div></div></a></div><div><a href="/2022/10/29/build-official-python3-11/" title="Ubuntu 上编译安装官网 Python"><img class="cover" src="/img/c10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-29</div><div class="title">Ubuntu 上编译安装官网 Python</div></div></a></div><div><a href="/2020/11/09/jupyterlab-nginx/" title="利用 nginx 反向代理为 jupyterlab 配置二级网址页面"><img class="cover" src="/img/c11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-09</div><div class="title">利用 nginx 反向代理为 jupyterlab 配置二级网址页面</div></div></a></div><div><a href="/2023/04/12/mac-convert-python-to-macosx-app/" title="Mac 下打包 Python 程序"><img class="cover" src="/img/c23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-12</div><div class="title">Mac 下打包 Python 程序</div></div></a></div><div><a href="/2023/08/25/mac-terminal-linux-chinese-characters/" title="Mac ssh 连接 Linux 终端中文显示乱码解决方法"><img class="cover" src="/img/c22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-25</div><div class="title">Mac ssh 连接 Linux 终端中文显示乱码解决方法</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/silence.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jinzhong Xu</div><div class="author-info__description">众妙之门</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">384</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">296</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">25</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xujinzh"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xujinzh" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xujinzhong027@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.mathscv.com" target="_blank" title="MathsCVBlog"><i class="fab fa-j"></i></a><a class="social-icon" href="https://xujinzh.github.io" target="_blank" title="GitHubBlog"><i class="fab fa-github-alt"></i></a><a class="social-icon" href="https://www.mathscv.com/power" target="_blank" title="MathsCVPower"><i class="fab fa-m"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">日本核污染水强排入海！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.</span> <span class="toc-text">启动方法的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%90%AF%E5%8A%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">设置启动方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">3.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">3.2.</span> <span class="toc-text">方法二</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QA"><span class="toc-number">4.</span> <span class="toc-text">QA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">5.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/01/27/linux-grep/" title="linux 三剑客 - 文本查找命令 grep"><img src="/img/c23.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="linux 三剑客 - 文本查找命令 grep"/></a><div class="content"><a class="title" href="/2024/01/27/linux-grep/" title="linux 三剑客 - 文本查找命令 grep">linux 三剑客 - 文本查找命令 grep</a><time datetime="2024-01-27T10:04:18.000Z" title="发表于 2024-01-27 18:04:18">2024-01-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/21/ai-internlm-opencompass/" title="基于 OpenCompass 的大模型评测"><img src="/img/c13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 OpenCompass 的大模型评测"/></a><div class="content"><a class="title" href="/2024/01/21/ai-internlm-opencompass/" title="基于 OpenCompass 的大模型评测">基于 OpenCompass 的大模型评测</a><time datetime="2024-01-21T05:36:33.000Z" title="发表于 2024-01-21 13:36:33">2024-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/17/python-torch-multi-gpu-py/" title="Python 多进程使用单机多GPU加速推理"><img src="/img/c14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 多进程使用单机多GPU加速推理"/></a><div class="content"><a class="title" href="/2024/01/17/python-torch-multi-gpu-py/" title="Python 多进程使用单机多GPU加速推理">Python 多进程使用单机多GPU加速推理</a><time datetime="2024-01-17T06:53:55.000Z" title="发表于 2024-01-17 14:53:55">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/13/ai-internlm-lmdeploy/" title="基于 LMDeploy 的大模型量化和部署"><img src="/img/c2.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 LMDeploy 的大模型量化和部署"/></a><div class="content"><a class="title" href="/2024/01/13/ai-internlm-lmdeploy/" title="基于 LMDeploy 的大模型量化和部署">基于 LMDeploy 的大模型量化和部署</a><time datetime="2024-01-13T06:07:33.000Z" title="发表于 2024-01-13 14:07:33">2024-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/12/ai-internlm-personal-assistant-based-on-xtuner/" title="利用 XTuner 训练书生·浦语私人大模型助手"><img src="/img/c11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用 XTuner 训练书生·浦语私人大模型助手"/></a><div class="content"><a class="title" href="/2024/01/12/ai-internlm-personal-assistant-based-on-xtuner/" title="利用 XTuner 训练书生·浦语私人大模型助手">利用 XTuner 训练书生·浦语私人大模型助手</a><time datetime="2024-01-12T11:03:54.000Z" title="发表于 2024-01-12 19:03:54">2024-01-12</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By Jinzhong Xu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '695ca5d39e2ba2f9feb5',
      clientSecret: '9d4027af6364ff54595b7a8580977ec58c38a5ae',
      repo: 'xujinzh.github.io',
      owner: 'xujinzh',
      admin: ['xujinzh'],
      id: '82f14ea030f597f20740fb651b504a62',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="众,妙,之,门" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>